<!doctype html><html lang=zh-cn><head><title>Pickle Error - 世界的过客</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="The HTML5 Herald"><meta name=author content="Jay Lau"><meta property="og:title" content="Pickle Error"><meta property="og:description" content="Error Message cPickle.PicklingError: Can't pickle shell python3 -m trace -tg --ignore-dir /Library $1 bug code def process_way(): workers = 10 with futures."><meta property="og:type" content="article"><meta property="og:url" content="https://laujay.com/posts/pickle-error/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-10-17T13:52:34+08:00"><meta property="article:modified_time" content="2017-10-17T13:52:34+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Pickle Error"><meta name=twitter:description content="Error Message cPickle.PicklingError: Can't pickle shell python3 -m trace -tg --ignore-dir /Library $1 bug code def process_way(): workers = 10 with futures."><meta name=generator content="Hugo 0.83.1"><link rel="shortcut icon" href=https://laujay.com/img/favicon.ico><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><link rel=stylesheet href=https://laujay.com/fontawesome/css/all.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda"><link rel=stylesheet type=text/css href=https://laujay.com/css/styles.css></head><body><div id=container><header><h1><a href=https://laujay.com/>世界的过客</a></h1><ul id=social-media><li><a href=https://github.com/lau-jay title=GitHub><i class="fab fa-github fa-lg"></i></a></li></ul><p><em>每个人获得的东西都恰好是他值得获得的东西</em></p></header><nav><ul><li><a href=https://laujay.com/about><i class="fa-li fa fa-lg"></i><span>About</span></a></li><li><a href=https://laujay.com/categories><i class="fa-li fa fa-lg"></i><span>Categories</span></a></li><li><a href=https://laujay.com/tags><i class="fa-li fa fa-lg"></i><span>Tags</span></a></li></ul></nav><main><article><h1>Pickle Error</h1><aside><ul><li><time class=post-date datetime=2017-10-17T13:52:34+08:00>Oct 17, 2017</time></li><li>Categories:
<em><a href=https://laujay.com/categories/python>python</a></em></li><li><em><a href=https://laujay.com/tags/python>#python</a></em></li><li>One minute read</li></ul></aside><div class=featured_image><a href=https://laujay.com/posts/pickle-error/ title="Pickle Error"><img src></a></div><h3 id=error-message>Error Message</h3><pre><code>cPickle.PicklingError: Can't pickle

</code></pre><h3 id=shell>shell</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>python3 -m trace -tg --ignore-dir /Library $1
</code></pre></div><h3 id=bug-code>bug code</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>process_way</span>():
    workers <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>
    <span style=color:#66d9ef>with</span> futures<span style=color:#f92672>.</span>ProcessPoolExecutor(workers) <span style=color:#66d9ef>as</span> executor:
        futs <span style=color:#f92672>=</span> {executor<span style=color:#f92672>.</span>submit(blocking_way) <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>10</span>)}
    <span style=color:#66d9ef>return</span> len([fut<span style=color:#f92672>.</span>result() <span style=color:#66d9ef>for</span> fut <span style=color:#f92672>in</span> futs])
</code></pre></div><h3 id=reason>Reason</h3><pre><code>Pool methods all use a queue.Queue to pass tasks to the worker processes.
Everything that goes through the queue.Queue must be pickable.
So, multiprocessing can only transfer Python objects to worker processes which can be pickled.
Functions are only picklable if they are defined at the top-level of a module, bound methods are not picklable.
</code></pre><h3 id=fixed>Fixed</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>process_way</span>():
    workers <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>
    <span style=color:#66d9ef>with</span> futures<span style=color:#f92672>.</span>ThreadPoolExecutor(workers) <span style=color:#66d9ef>as</span> executor:
        futs <span style=color:#f92672>=</span> {executor<span style=color:#f92672>.</span>submit(blocking_way) <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>10</span>)}
    <span style=color:#66d9ef>return</span> len([fut<span style=color:#f92672>.</span>result() <span style=color:#66d9ef>for</span> fut <span style=color:#f92672>in</span> futs])
</code></pre></div></article><section class=post-nav><ul><li><a href=https://laujay.com/posts/blog-ci/><i class="fa fa-chevron-circle-left"></i> Blog Ci</a></li><li><a href=https://laujay.com/posts/deploy_and_using_https/>CentOS升级HTTPS <i class="fa fa-chevron-circle-right"></i></a></li></ul></section><section class=comments-block><button id=show-comments style=display:none><i class="fa fa-comments"></i> Add/View Comments</button></section><section id=disqus_thread></section><script>(function(){var b,e,c,f,g,d;if(window.location.hostname=="localhost")return;if(b=!1,e='lau-jay',c=document.getElementById("show-comments"),f=!0,g=null,g)return;c.style.display="",f?a():c.addEventListener("click",a,!1);function a(){if(!b){b=!0;var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="//"+e+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a),document.getElementById("show-comments").style.display="none"}}d=window.location.hash.substr(1),d.length>8&&d.substring(0,8)=="comment-"&&a(),/bot|google|baidu|bing|msn|duckduckgo|slurp|yandex/i.test(navigator.userAgent)&&a()})()</script></main><footer><h6>Copyright © 2016 ~ 2021 - Jay Lau|Theme by <a href=https://github.com/funkydan2/hugo-kiera>kiera</a> |
Rendered by <a href=https://gohugo.io title=Hugo>Hugo</a> |
<a href=https://laujay.com/index.xml>Subscribe</a></h6></footer></div><script src=https://laujay.com/js/scripts.js></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-91611718-2','auto'),ga('send','pageview'))</script></body></html>